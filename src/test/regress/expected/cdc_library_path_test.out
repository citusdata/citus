\set VERBOSITY terse
SHOW dynamic_library_path;
 dynamic_library_path 
----------------------
 $libdir
(1 row)

SHOW citus.enable_change_data_capture;
 citus.enable_change_data_capture 
----------------------------------
 off
(1 row)

SELECT current_setting('dynamic_library_path') AS initial_path;
 initial_path 
--------------
 $libdir
(1 row)

SET citus.enable_change_data_capture = true;
SHOW dynamic_library_path;
 dynamic_library_path 
----------------------
 $libdir
(1 row)

SELECT 
    CASE 
        WHEN current_setting('dynamic_library_path') LIKE '%citus_decoders%' 
        THEN 'CDC path correctly set'
        ELSE 'CDC path not set'
    END AS cdc_path_status;
 cdc_path_status 
-----------------
 CDC path not set
(1 row)

SET citus.enable_change_data_capture = false;
SET dynamic_library_path = '$libdir/custom_lib:$libdir';
SET citus.enable_change_data_capture = true;
SHOW dynamic_library_path;
 dynamic_library_path 
----------------------
 $libdir/custom_lib:$libdir
(1 row)

RESET citus.enable_change_data_capture;
RESET dynamic_library_path;
SHOW citus.enable_change_data_capture;
 citus.enable_change_data_capture 
----------------------------------
 off
(1 row)

SHOW dynamic_library_path;
 dynamic_library_path 
----------------------
 $libdir
(1 row)

SET dynamic_library_path = '';
SET citus.enable_change_data_capture = true;
SHOW dynamic_library_path;
 dynamic_library_path 
----------------------
 
(1 row)

SET dynamic_library_path = '/custom/path';
SET citus.enable_change_data_capture = true;
SHOW dynamic_library_path;
 dynamic_library_path 
----------------------
 /custom/path
(1 row)

RESET citus.enable_change_data_capture;
RESET dynamic_library_path;
