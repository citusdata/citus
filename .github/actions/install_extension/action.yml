name: install_extension
inputs:
  pg_major:
    required: false
runs:
  using: composite
  steps:
  - name: Expose $PG_MAJOR to Github Env
    run: echo "PG_MAJOR=${{ inputs.pg_major || env.PG_MAJOR }}" >> $GITHUB_ENV
    shell: bash
  - uses: actions/download-artifact@v3.0.1
    with:
      name: build-${{ env.PG_MAJOR }}
  - name: Install Extension
    run: tar xfv "install-$PG_MAJOR.tar" --directory /
    shell: bash
  - name: Configure
    run: |-
      chown -R circleci .
      git config --global --add safe.directory ${GITHUB_WORKSPACE}
      gosu circleci ./configure --without-pg-version-check
    shell: bash
  - name: Enable core dumps
    run: ulimit -c unlimited
    shell: bash
